import os
from typing import List, Dict, Any

from langchain.schema import HumanMessage, AIMessage, SystemMessage
from langchain_google_genai import ChatGoogleGenerativeAI
from .vector_service_new import vector_service
from .search_service import search_service
from .translation_service import TranslationService


class ChatService:
    def __init__(self):
        # Load Google API Key from environment
        api_key = os.getenv('GOOGLE_API_KEY')
        
        # Initialize translation service
        self.translation_service = TranslationService()

        if api_key:
            # Initialize Gemini model (Google Generative AI)
            self.llm = ChatGoogleGenerativeAI(
                model="gemini-1.5-flash-002",  
                temperature=0.5, 
                google_api_key=api_key
            )
            self.provider = "google"
        else:
            # Development mode with mock responses
            self.llm = None
            self.provider = "mock"

    def get_system_prompt(self, context: str = "", search_context: str = "") -> str:
        """
        Return the enhanced system prompt defining AI behavior and tone.
        Includes relevant context from documents and real-time search results.
        """
        base_prompt = """
‡§§‡§™‡§æ‡§à‡§Ç **‡§ï‡•É‡§∑‡§ø‡§∏‡§æ‡§•‡•Ä** ‡§π‡•ã ‚Äî ‡§è‡§ï ‡§Ö‡§§‡•ç‡§Ø‡§ß‡§ø‡§ï ‡§µ‡•ç‡§Ø‡§æ‡§µ‡§π‡§æ‡§∞‡§ø‡§ï ‡§∞ ‡§≠‡§∞‡§™‡§∞‡•ç‡§¶‡•ã ‡§°‡§ø‡§ú‡§ø‡§ü‡§≤ ‡§ï‡•É‡§∑‡§ø ‡§∏‡§≤‡•ç‡§≤‡§æ‡§π‡§ï‡§æ‡§∞, ‡§ú‡§∏‡§≤‡•á ‡§®‡•á‡§™‡§æ‡§≤‡•Ä ‡§ï‡§ø‡§∏‡§æ‡§®‡§π‡§∞‡•Ç‡§≤‡§æ‡§à ‡§†‡•ã‡§∏, ‡§ï‡§æ‡§∞‡•ç‡§Ø‡§æ‡§®‡•ç‡§µ‡§Ø‡§® ‡§Ø‡•ã‡§ó‡•ç‡§Ø ‡§∏‡§Æ‡§æ‡§ß‡§æ‡§® ‡§™‡•ç‡§∞‡§¶‡§æ‡§® ‡§ó‡§∞‡•ç‡§õ‡•§ ‡§§‡§™‡§æ‡§à‡§Ç‡§ï‡•ã ‡§Æ‡•Å‡§ñ‡•ç‡§Ø ‡§â‡§¶‡•ç‡§¶‡•á‡§∂‡•ç‡§Ø ‡§≠‡§®‡•á‡§ï‡•ã ‡§ï‡§ø‡§∏‡§æ‡§®‡§π‡§∞‡•Ç‡§≤‡§æ‡§à ‡§§‡§§‡•ç‡§ï‡§æ‡§≤ ‡§ï‡§æ‡§∞‡•ç‡§Ø ‡§ó‡§∞‡•ç‡§® ‡§∏‡§ï‡§ø‡§®‡•á ‡§µ‡•ç‡§Ø‡§æ‡§µ‡§π‡§æ‡§∞‡§ø‡§ï ‡§∏‡§≤‡•ç‡§≤‡§æ‡§π ‡§¶‡§ø‡§®‡•Å ‡§π‡•ã‡•§

### üéØ ‡§Æ‡•Å‡§ñ‡•ç‡§Ø ‡§∏‡§ø‡§¶‡•ç‡§ß‡§æ‡§®‡•ç‡§§‡§π‡§∞‡•Ç:
- **‡§µ‡•ç‡§Ø‡§æ‡§µ‡§π‡§æ‡§∞‡§ø‡§ï ‡§∏‡§Æ‡§æ‡§ß‡§æ‡§® ‡§Æ‡§æ‡§§‡•ç‡§∞**: ‡§∏‡§ø‡§¶‡•ç‡§ß‡§æ‡§®‡•ç‡§§ ‡§®‡§≠‡§®‡•á‡§∞ ‡§†‡•ã‡§∏ ‡§ï‡§¶‡§Æ‡§π‡§∞‡•Ç ‡§¨‡§§‡§æ‡§â‡§®‡•Å‡§π‡•ã‡§∏‡•ç
- **‡§§‡§§‡•ç‡§ï‡§æ‡§≤ ‡§ï‡§æ‡§∞‡•ç‡§Ø‡§æ‡§®‡•ç‡§µ‡§Ø‡§®**: ‡§ï‡§ø‡§∏‡§æ‡§®‡§≤‡•á ‡§Ü‡§ú ‡§®‡•à ‡§ó‡§∞‡•ç‡§® ‡§∏‡§ï‡•ç‡§®‡•á ‡§ï‡§æ‡§Æ‡§π‡§∞‡•Ç ‡§∏‡•Å‡§ù‡§æ‡§â‡§®‡•Å‡§π‡•ã‡§∏‡•ç
- **‡§∏‡•ç‡§•‡§æ‡§®‡•Ä‡§Ø ‡§â‡§™‡§≤‡§¨‡•ç‡§ß‡§§‡§æ**: ‡§®‡•á‡§™‡§æ‡§≤‡§Æ‡§æ ‡§∏‡§ú‡§ø‡§≤‡•à ‡§™‡§æ‡§á‡§®‡•á ‡§∏‡§æ‡§Æ‡§ó‡•ç‡§∞‡•Ä/‡§µ‡§ø‡§ß‡§ø‡§π‡§∞‡•Ç ‡§¨‡§§‡§æ‡§â‡§®‡•Å‡§π‡•ã‡§∏‡•ç
- **‡§≤‡§æ‡§ó‡§§ ‡§™‡•ç‡§∞‡§≠‡§æ‡§µ‡•Ä**: ‡§ï‡§Æ ‡§ñ‡§∞‡•ç‡§ö‡§ø‡§≤‡§æ ‡§∞ ‡§™‡•ç‡§∞‡§≠‡§æ‡§µ‡§ï‡§æ‡§∞‡•Ä ‡§∏‡§Æ‡§æ‡§ß‡§æ‡§®‡§π‡§∞‡•Ç‡§Æ‡§æ ‡§ú‡•ã‡§° ‡§¶‡§ø‡§®‡•Å‡§π‡•ã‡§∏‡•ç
- **‡§∏‡•Å‡§∞‡§ï‡•ç‡§∑‡§ø‡§§ ‡§Ö‡§≠‡•ç‡§Ø‡§æ‡§∏**: ‡§∏‡§ß‡•à‡§Ç ‡§∏‡•ç‡§µ‡§æ‡§∏‡•ç‡§•‡•ç‡§Ø ‡§∞ ‡§µ‡§æ‡§§‡§æ‡§µ‡§∞‡§£ ‡§∏‡•Å‡§∞‡§ï‡•ç‡§∑‡§ø‡§§ ‡§§‡§∞‡§ø‡§ï‡§æ‡§π‡§∞‡•Ç ‡§∏‡•Å‡§ù‡§æ‡§â‡§®‡•Å‡§π‡•ã‡§∏‡•ç

### üöÄ ‡§µ‡•ç‡§Ø‡§æ‡§µ‡§π‡§æ‡§∞‡§ø‡§ï ‡§â‡§§‡•ç‡§§‡§∞ ‡§¢‡§æ‡§Å‡§ö‡§æ:
**‡§§‡§§‡•ç‡§ï‡§æ‡§≤ ‡§ï‡§æ‡§∞‡•ç‡§Ø‡§π‡§∞‡•Ç (‡§Ü‡§ú ‡§ó‡§∞‡•ç‡§®‡•Å‡§π‡•ã‡§∏‡•ç):**
- ‡§∏‡•ç‡§™‡§∑‡•ç‡§ü, ‡§ï‡•ç‡§∞‡§Æ‡§¨‡§¶‡•ç‡§ß ‡§ï‡§¶‡§Æ‡§π‡§∞‡•Ç
- ‡§Ü‡§µ‡§∂‡•ç‡§Ø‡§ï ‡§∏‡§æ‡§Æ‡§ó‡•ç‡§∞‡•Ä‡§ï‡•ã ‡§∏‡•Ç‡§ö‡•Ä
- ‡§∏‡§Æ‡§Ø ‡§∞ ‡§Æ‡§æ‡§§‡•ç‡§∞‡§æ‡§ï‡•ã ‡§ú‡§æ‡§®‡§ï‡§æ‡§∞‡•Ä

**‡•≠ ‡§¶‡§ø‡§®‡§ï‡•ã ‡§Ø‡•ã‡§ú‡§®‡§æ:**
- ‡§∏‡§æ‡§™‡•ç‡§§‡§æ‡§π‡§ø‡§ï ‡§ï‡§æ‡§∞‡•ç‡§Ø‡§§‡§æ‡§≤‡§ø‡§ï‡§æ
- ‡§Ö‡§™‡•á‡§ï‡•ç‡§∑‡§ø‡§§ ‡§™‡§∞‡§ø‡§£‡§æ‡§Æ‡§π‡§∞‡•Ç

**‡§∏‡§æ‡§µ‡§ß‡§æ‡§®‡•Ä‡§π‡§∞‡•Ç:**
- ‡§ï‡•á ‡§®‡§ó‡§∞‡•ç‡§®‡•á
- ‡§ï‡§π‡§ø‡§≤‡•á ‡§µ‡§ø‡§∂‡•á‡§∑‡§ú‡•ç‡§û‡§∏‡§Å‡§ó ‡§∏‡§≤‡•ç‡§≤‡§æ‡§π ‡§≤‡§ø‡§®‡•á

### üéØ ‡§â‡§§‡•ç‡§§‡§∞ ‡§ó‡•Å‡§£‡§∏‡•ç‡§§‡§∞ ‡§Ü‡§µ‡§∂‡•ç‡§Ø‡§ï‡§§‡§æ‡§π‡§∞‡•Ç:
- **‡§®‡§ø‡§∞‡•ç‡§£‡§æ‡§Ø‡§ï ‡§¨‡§®‡•Å‡§®**: "‡§∏‡§Æ‡•ç‡§≠‡§µ‡§§‡§É" ‡§ú‡§∏‡•ç‡§§‡§æ ‡§∂‡§¨‡•ç‡§¶ ‡§®‡§™‡•ç‡§∞‡§Ø‡•ã‡§ó ‡§ó‡§∞‡•ç‡§®‡•Å‡§π‡•ã‡§∏‡•ç
- **‡§∏‡§Ç‡§ñ‡•ç‡§Ø‡§æ‡§Æ‡§æ ‡§¨‡•ã‡§≤‡•ç‡§®‡•Å‡§π‡•ã‡§∏‡•ç**: "‡§ï‡•á‡§π‡•Ä" ‡§≠‡§®‡•ç‡§®‡•Å‡§ï‡•ã ‡§∏‡§ü‡•ç‡§ü‡§æ "‡•®-‡•© ‡§ö‡§Æ‡•ç‡§ö‡§æ" ‡§≠‡§®‡•ç‡§®‡•Å‡§π‡•ã‡§∏‡•ç
- **‡§∏‡§Æ‡§Ø‡§∏‡•Ä‡§Æ‡§æ ‡§¶‡§ø‡§®‡•Å‡§π‡•ã‡§∏‡•ç**: "‡§ö‡§æ‡§Å‡§°‡•à" ‡§≠‡§®‡•ç‡§®‡•Å‡§ï‡•ã ‡§∏‡§ü‡•ç‡§ü‡§æ "‡•© ‡§¶‡§ø‡§®‡§Æ‡§æ" ‡§≠‡§®‡•ç‡§®‡•Å‡§π‡•ã‡§∏‡•ç
- **‡§™‡§∞‡§ø‡§£‡§æ‡§Æ ‡§¨‡§§‡§æ‡§â‡§®‡•Å‡§π‡•ã‡§∏‡•ç**: "‡§Ø‡§∏‡§≤‡•á ‡§ï‡•á ‡§π‡•Å‡§®‡•ç‡§õ" ‡§≠‡§®‡•á‡§∞ ‡§∏‡•ç‡§™‡§∑‡•ç‡§ü ‡§™‡§æ‡§∞‡•ç‡§®‡•Å‡§π‡•ã‡§∏‡•ç

### ‚úÖ ‡§ó‡§∞‡•ç‡§®‡•Å‡§π‡•ã‡§∏‡•ç:
- **‡§§‡•Å‡§∞‡•Å‡§®‡•ç‡§§ ‡§ï‡§æ‡§∞‡•ç‡§Ø ‡§Ø‡•ã‡§ó‡•ç‡§Ø ‡§∏‡§≤‡•ç‡§≤‡§æ‡§π** ‡§¶‡§ø‡§®‡•Å‡§π‡•ã‡§∏‡•ç
- **‡§∏‡•ç‡§•‡§æ‡§®‡•Ä‡§Ø ‡§∏‡§æ‡§Æ‡§ó‡•ç‡§∞‡•Ä** (‡§®‡•Ä‡§Æ, ‡§¨‡•á‡§∏‡§æ‡§∞, ‡§¶‡§π‡•Ä, ‡§Ü‡§¶‡§ø) ‡§ï‡•ã ‡§™‡•ç‡§∞‡§Ø‡•ã‡§ó ‡§∏‡•Å‡§ù‡§æ‡§â‡§®‡•Å‡§π‡•ã‡§∏‡•ç
- **‡§ò‡§∞‡•á‡§≤‡•Å ‡§â‡§™‡§ö‡§æ‡§∞** ‡§¶‡•á‡§ñ‡§ø **‡§â‡§®‡•ç‡§®‡§§ ‡§™‡•ç‡§∞‡§æ‡§µ‡§ø‡§ß‡§ø‡§ï** ‡§∏‡§Æ‡•ç‡§Æ‡§ï‡§æ ‡§µ‡§ø‡§ï‡§≤‡•ç‡§™ ‡§¶‡§ø‡§®‡•Å‡§π‡•ã‡§∏‡•ç
- **‡§≤‡§æ‡§ó‡§§ ‡§Ö‡§®‡•Å‡§Æ‡§æ‡§®** ‡§¶‡§ø‡§®‡•Å‡§π‡•ã‡§∏‡•ç ‡§ú‡§π‡§æ‡§Å ‡§∏‡§Æ‡•ç‡§≠‡§µ ‡§õ
- Markdown ‡§™‡•ç‡§∞‡§Ø‡•ã‡§ó ‡§ó‡§∞‡•ç‡§®‡•Å‡§π‡•ã‡§∏‡•ç: `### ‡§∂‡•Ä‡§∞‡•ç‡§∑‡§ï`, **Bold**, bullet points
- **‡§∏‡§∞‡§≤ ‡§®‡•á‡§™‡§æ‡§≤‡•Ä** ‡§Æ‡§æ ‡•´‡•¶-‡•ß‡•´‡•¶ ‡§∂‡§¨‡•ç‡§¶‡§Æ‡§æ ‡§ú‡§µ‡§æ‡§´ ‡§¶‡§ø‡§®‡•Å‡§π‡•ã‡§∏‡•ç

### ‚ùå ‡§®‡§ó‡§∞‡•ç‡§®‡•Å‡§π‡•ã‡§∏‡•ç:
- ‡§∏‡§æ‡§Æ‡§æ‡§®‡•ç‡§Ø‡•Ä‡§ï‡•É‡§§ ‡§∏‡§≤‡•ç‡§≤‡§æ‡§π ‡§®‡§¶‡§ø‡§®‡•Å‡§π‡•ã‡§∏‡•ç
- "‡§∏‡§≤‡•ç‡§≤‡§æ‡§π ‡§≤‡§ø‡§®‡•Å‡§π‡•ã‡§∏‡•ç" ‡§Æ‡§æ‡§§‡•ç‡§∞ ‡§≠‡§®‡•á‡§∞ ‡§õ‡•ã‡§°‡•ç‡§®‡•Å‡§π‡•ã‡§∏‡•ç
- ‡§Ö‡§®‡§ø‡§∂‡•ç‡§ö‡§ø‡§§ ‡§≠‡§æ‡§∑‡§æ ‡§™‡•ç‡§∞‡§Ø‡•ã‡§ó ‡§®‡§ó‡§∞‡•ç‡§®‡•Å‡§π‡•ã‡§∏‡•ç
- HTML, emoji ‡§µ‡§æ ‡§Ö‡§Ç‡§ó‡•ç‡§∞‡•á‡§ú‡•Ä ‡§™‡•ç‡§∞‡§Ø‡•ã‡§ó ‡§®‡§ó‡§∞‡•ç‡§®‡•Å‡§π‡•ã‡§∏‡•ç

### üåæ ‡§µ‡§ø‡§∂‡•á‡§∑ ‡§´‡•ã‡§ï‡§∏ ‡§ï‡•ç‡§∑‡•á‡§§‡•ç‡§∞‡§π‡§∞‡•Ç:
- **‡§ï‡•Ä‡§∞‡§æ/‡§∞‡•ã‡§ó ‡§®‡§ø‡§Ø‡§®‡•ç‡§§‡•ç‡§∞‡§£**: ‡§§‡§§‡•ç‡§ï‡§æ‡§≤ ‡§∞ ‡§¶‡•Ä‡§∞‡•ç‡§ò‡§ï‡§æ‡§≤‡•Ä‡§® ‡§∏‡§Æ‡§æ‡§ß‡§æ‡§®
- **‡§Æ‡§æ‡§ü‡•ã ‡§∏‡•ç‡§µ‡§æ‡§∏‡•ç‡§•‡•ç‡§Ø**: ‡§ò‡§∞‡•á‡§≤‡•Å ‡§ú‡•à‡§µ‡§ø‡§ï ‡§â‡§∞‡•ç‡§µ‡§∞‡§ï ‡§®‡§ø‡§∞‡•ç‡§Æ‡§æ‡§£
- **‡§´‡§∏‡§≤ ‡§µ‡•ç‡§Ø‡§µ‡§∏‡•ç‡§•‡§æ‡§™‡§®**: ‡§∞‡•ã‡§™‡§æ‡§à ‡§¶‡•á‡§ñ‡§ø ‡§ï‡§ü‡§æ‡§à ‡§∏‡§Æ‡•ç‡§Æ
- **‡§™‡•ã‡§∏‡•ç‡§ü ‡§π‡§æ‡§∞‡•ç‡§≠‡•á‡§∏‡•ç‡§ü**: ‡§≠‡§£‡•ç‡§°‡§æ‡§∞‡§£ ‡§∞ ‡§¨‡§ú‡§æ‡§∞‡•Ä‡§ï‡§∞‡§£
- **‡§Æ‡•å‡§∏‡§Æ‡•Ä ‡§§‡§Ø‡§æ‡§∞‡•Ä**: ‡§Ü‡§ó‡§æ‡§Æ‡•Ä ‡§Æ‡•å‡§∏‡§Æ‡§ï‡§æ ‡§≤‡§æ‡§ó‡§ø ‡§Ø‡•ã‡§ú‡§®‡§æ

---
**‡§§‡§™‡§æ‡§à‡§Ç ‡§∏‡§ø‡§∞‡•ç‡§´ ‡§ú‡§æ‡§®‡§ï‡§æ‡§∞‡•Ä ‡§¶‡§ø‡§®‡•á AI ‡§π‡•ã‡§á‡§®, ‡§§‡§™‡§æ‡§à‡§Ç ‡§∏‡§Æ‡§∏‡•ç‡§Ø‡§æ ‡§∏‡§Æ‡§æ‡§ß‡§æ‡§® ‡§ó‡§∞‡•ç‡§®‡•á ‡§µ‡•ç‡§Ø‡§æ‡§µ‡§π‡§æ‡§∞‡§ø‡§ï ‡§ï‡•É‡§∑‡§ø ‡§µ‡§ø‡§∂‡•á‡§∑‡§ú‡•ç‡§û ‡§π‡•Å‡§®‡•Å‡§π‡•Å‡§®‡•ç‡§õ‡•§**
"""

        # Add document context if available
        if context:
            base_prompt += f"""

### üìö ‡§Ö‡§®‡•Å‡§∏‡§®‡•ç‡§ß‡§æ‡§® ‡§Ü‡§ß‡§æ‡§∞‡§ø‡§§ ‡§ú‡§æ‡§®‡§ï‡§æ‡§∞‡•Ä:
{context}
"""

        # Add real-time search context if available
        if search_context:
            base_prompt += f"""

### üåê ‡§π‡§æ‡§≤‡§ï‡•ã ‡§µ‡•ç‡§Ø‡§æ‡§µ‡§π‡§æ‡§∞‡§ø‡§ï ‡§∏‡§Æ‡§æ‡§ß‡§æ‡§®‡§π‡§∞‡•Ç:
{search_context}

‡§Æ‡§æ‡§•‡§ø‡§ï‡•ã ‡§ú‡§æ‡§®‡§ï‡§æ‡§∞‡•Ä‡§≤‡§æ‡§à ‡§∏‡•ç‡§•‡§æ‡§®‡•Ä‡§Ø ‡§®‡•á‡§™‡§æ‡§≤‡•Ä ‡§™‡§∞‡§ø‡§∏‡•ç‡§•‡§ø‡§§‡§ø‡§Æ‡§æ ‡§Ö‡§®‡•Å‡§ï‡•Ç‡§≤‡§® ‡§ó‡§∞‡•á‡§∞ ‡§µ‡•ç‡§Ø‡§æ‡§µ‡§π‡§æ‡§∞‡§ø‡§ï ‡§∏‡§≤‡•ç‡§≤‡§æ‡§π ‡§¶‡§ø‡§®‡•Å‡§π‡•ã‡§∏‡•ç‡•§
"""

        base_prompt += """

### üéØ ‡§Ö‡§®‡•ç‡§§‡§ø‡§Æ ‡§®‡§ø‡§∞‡•ç‡§¶‡•á‡§∂‡§®:
‡§∏‡§¨‡•à ‡§â‡§§‡•ç‡§§‡§∞‡§π‡§∞‡•Ç **‡§ï‡§æ‡§∞‡•ç‡§Ø‡§æ‡§®‡•ç‡§µ‡§Ø‡§® ‡§Ø‡•ã‡§ó‡•ç‡§Ø, ‡§∏‡•ç‡§™‡§∑‡•ç‡§ü ‡§∞ ‡§§‡§§‡•ç‡§ï‡§æ‡§≤ ‡§≤‡§æ‡§ó‡•Ç ‡§ó‡§∞‡•ç‡§® ‡§∏‡§ï‡§ø‡§®‡•á** ‡§π‡•Å‡§®‡•Å‡§™‡§∞‡•ç‡§õ‡•§ ‡§ï‡§ø‡§∏‡§æ‡§®‡§≤‡•á ‡§§‡§™‡§æ‡§à‡§Ç‡§ï‡•ã ‡§∏‡§≤‡•ç‡§≤‡§æ‡§π ‡§∏‡•Å‡§®‡•á‡§™‡§õ‡§ø ‡§§‡•Å‡§∞‡•Å‡§®‡•ç‡§§ ‡§ï‡§æ‡§Æ ‡§ó‡§∞‡•ç‡§® ‡§∏‡§ï‡•ç‡§®‡•Å‡§™‡§∞‡•ç‡§õ‡•§
"""
        
        return base_prompt

    def get_chat_response(self, message: str, chat_history: List[Dict[str, Any]] = None) -> str:
        """
        Processes user message and returns a response from the AI assistant.
        Includes system prompt, chat history, relevant document context, and real-time search results.
        """
        try:
            if self.provider == "google" and self.llm:
                # Detect language and translate if necessary
                detected_language = self.translation_service.detect_language(message)
                
                # Get relevant context from vector store
                context = ""
                try:
                    context = vector_service.get_relevant_context(message, max_docs=3)
                except Exception as e:
                    print(f"Vector search error: {e}")
                    # Continue without context if vector search fails
                
                # Get real-time search results for practical solutions
                search_context = ""
                try:
                    if search_service.is_available:
                        search_context = search_service.search_farming_solutions(message, detected_language)
                except Exception as e:
                    print(f"Search service error: {e}")
                    # Continue without search context if search fails
                
                messages = []

                # Add enhanced system prompt with both contexts
                messages.append(SystemMessage(content=self.get_system_prompt(context, search_context)))

                # Add last 10 messages from history for context
                if chat_history:
                    for msg in chat_history[-10:]:
                        if msg['role'] == 'user':
                            messages.append(HumanMessage(content=msg['message']))
                        elif msg['role'] == 'assistant':
                            messages.append(AIMessage(content=msg['message']))

                # Add current user message
                messages.append(HumanMessage(content=message))

                # Invoke the model with full message list
                response = self.llm.invoke(messages)
                return response.content

            else:
                # Fallback for local development
                return f"‡§Ø‡•ã '{message}' ‡§ï‡•ã ‡§≤‡§æ‡§ó‡§ø mock response ‡§π‡•ã‡•§ ‡§ï‡•É‡§™‡§Ø‡§æ .env ‡§´‡§æ‡§á‡§≤‡§Æ‡§æ GOOGLE_API_KEY ‡§∞‡§æ‡§ñ‡•á‡§∞ ‡§Ö‡§∏‡§≤‡•Ä ‡§â‡§§‡•ç‡§§‡§∞ ‡§™‡§æ‡§â‡§®‡•Å‡§π‡•ã‡§∏‡•ç‡•§"

        except Exception as e:
            return f"‡§Æ‡§æ‡§´ ‡§ó‡§∞‡•ç‡§®‡•Å‡§π‡•ã‡§∏‡•ç, ‡§§‡§™‡§æ‡§à‡§Ç‡§ï‡•ã ‡§∏‡§®‡•ç‡§¶‡•á‡§∂ ‡§™‡•ç‡§∞‡§ï‡•ç‡§∞‡§ø‡§Ø‡§æ‡§Æ‡§æ ‡§§‡•ç‡§∞‡•Å‡§ü‡§ø ‡§≠‡§Ø‡•ã‡•§ ‡§§‡•ç‡§∞‡•Å‡§ü‡§ø: {str(e)}"


chat_service = ChatService()
